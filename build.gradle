plugins {
    id "com.diffplug.spotless" version "5.15.1"
}

apply plugin: "java"
apply plugin: "application"
apply plugin: "idea"

ext {
    dependencyVersions = [
        jackson_version: "2.12.5",
        aws_sdk_version: "1.12.73",
        aws_lambda_core_version: "1.2.1",
        aws_lambda_events_version: "3.10.0",
        nimbusds_oauth_version: "9.15",
        nimbusds_jwt_version: "9.14",
        junit: "5.8.0",
        jackson_version: "2.12.5",
        glassfish_version: "3.0.2",
    ]
}

subprojects {
    configurations {
        bouncycastle
        dynamodb
        glassfish
        govuk_notify
        hamcrest
        jackson
        lambda
        lambda_tests
        lettuce
        logging_runtime
        nimbus
        sqs
        tests
        test_runtime
    }

    dependencies {
        bouncycastle "org.bouncycastle:bcpkix-jdk15on:1.69"

        dynamodb "com.amazonaws:aws-java-sdk-dynamodb:${dependencyVersions.aws_sdk_version}"

        glassfish "org.glassfish.jersey.core:jersey-client:${dependencyVersions.glassfish_version}",
                "org.glassfish.jersey.inject:jersey-hk2:${dependencyVersions.glassfish_version}",
                "org.glassfish.jersey.media:jersey-media-json-jackson:${dependencyVersions.glassfish_version}"

        govuk_notify "uk.gov.service.notify:notifications-java-client:3.17.2-RELEASE"

        hamcrest "org.hamcrest:hamcrest:2.2"

        lambda "com.amazonaws:aws-lambda-java-core:${dependencyVersions.aws_lambda_core_version}",
                "com.amazonaws:aws-lambda-java-events:${dependencyVersions.aws_lambda_events_version}",
                "org.apache.logging.log4j:log4j-slf4j18-impl:2.13.0",
                "com.amazonaws:aws-lambda-java-log4j2:1.2.0"

        lambda_tests "com.amazonaws:aws-lambda-java-tests:1.1.0"

        lettuce "org.apache.commons:commons-pool2:2.11.1",
                "io.lettuce:lettuce-core:6.1.5.RELEASE"

        logging_runtime "org.apache.logging.log4j:log4j-slf4j18-impl:2.13.0",
                "com.amazonaws:aws-lambda-java-log4j2:1.2.0"

        jackson "com.fasterxml.jackson.core:jackson-core:${dependencyVersions.jackson_version}",
                "com.fasterxml.jackson.core:jackson-databind:${dependencyVersions.jackson_version}",
                "com.fasterxml.jackson.core:jackson-annotations:${dependencyVersions.jackson_version}",
                "com.fasterxml.jackson.datatype:jackson-datatype-jsr310:${dependencyVersions.jackson_version}"

        nimbus "com.nimbusds:oauth2-oidc-sdk:${dependencyVersions.nimbusds_oauth_version}",
                "com.nimbusds:nimbus-jose-jwt:${dependencyVersions.nimbusds_jwt_version}"


        sqs "software.amazon.awssdk:sqs:2.17.43"

        tests "org.junit.jupiter:junit-jupiter-api:${dependencyVersions.junit}",
                "org.junit.jupiter:junit-jupiter-params:${dependencyVersions.junit}",
                "org.mockito:mockito-core:3.12.4",
                "org.awaitility:awaitility:4.1.0",
                configurations.hamcrest

        test_runtime "org.junit.jupiter:junit-jupiter-engine:${dependencyVersions.junit}"
    }
}

spotless {
    java {
        target "**/*.java"
        googleJavaFormat("1.9").aosp()
        importOrder "", "javax", "java", "\\#"
    }

    groovyGradle {
        target "**/*.gradle"
        greclipse().configFile("tools/spotless-gradle.properties")
    }
}

compileJava.dependsOn "spotlessApply"
